# Convex URL = APP_URL + ":" + API_PORT (port is set once via API_PORT).
# On a server or behind a reverse proxy, set APP_URL to the public base URL, e.g.:
#   APP_URL=https://app.example.com  API_PORT=443  (or leave API_PORT=3210 if exposed)
services:
    ekklipse:
        platform: linux/amd64 # Convex backend requires amd64
        build:
            context: ..
            dockerfile: docker/Dockerfile
            args:
                APP_URL: ${APP_URL:-http://localhost}
                API_PORT: ${API_PORT:-3210}
                TARGETPLATFORM: linux/amd64
        image: ${DOCKER_IMAGE:-ekkolyth/ekklipse}:${DOCKER_TAG:-dev}
        container_name: ekklipse
        ports:
            - "${WEB_PORT:-3000}:3000"   # Frontend
            - "${API_PORT:-3210}:3210"   # Convex Backend API
        volumes:
            - ekklipse-data:/convex/data
        restart: unless-stopped

volumes:
    ekklipse-data:
        driver: local
