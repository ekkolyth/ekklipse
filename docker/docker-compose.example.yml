services:
    app:
        platform: linux/amd64 # Convex backend requires amd64
        build:
            context: ..
            dockerfile: docker/Dockerfile
            args:
                VITE_CONVEX_URL: http://localhost:3210
                TARGETPLATFORM: linux/amd64
        image: ${DOCKER_IMAGE:-ekkolyth/ekklipse}:${DOCKER_TAG:-dev}
        container_name: ekklipse
        ports:
            - "${PORT:-3000}:3000" # Frontend
            - "3210:3210" # Convex Backend API
        volumes:
            - convex-data:/convex/data
        restart: unless-stopped

volumes:
    convex-data:
        driver: local
