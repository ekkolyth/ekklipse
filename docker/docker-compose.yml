services:
    app:
        platform: linux/amd64 # Convex backend requires amd64
        build:
            context: ..
            dockerfile: docker/Dockerfile
            args:
                APP_URL: ${APP_URL:-http://localhost}
                API_PORT: ${API_PORT:-3210}
                TARGETPLATFORM: linux/amd64 # Convex backend requires amd64
        image: ${DOCKER_IMAGE:-ekkolyth/ekklipse}:${DOCKER_TAG:-dev}
        container_name: ekklipse
        ports:
            - "${WEBUI_PORT:-3000}:3000"
            - "${API_PORT:-3210}:3210"
        volumes:
            - convex-data:/convex/data
        environment:
            - INSTANCE_NAME=convex-self-hosted
            - APP_URL=${APP_URL:-http://localhost}
            - API_PORT=${API_PORT:-3210}
            - WEBUI_PORT=${WEBUI_PORT:-3000}
        restart: unless-stopped

volumes:
    convex-data:
        driver: local
